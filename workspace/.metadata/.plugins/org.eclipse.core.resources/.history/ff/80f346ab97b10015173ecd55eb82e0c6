import java.io.File;
import lejos.nxt.Sound;
import lejos.util.Delay;
import lejos.nxt.Button;
import lejos.nxt.LCD;
import lejos.nxt.Motor;
import lejos.nxt.SensorPort;
import lejos.nxt.SoundSensor;
import lejos.nxt.TouchSensor;
import lejos.nxt.UltrasonicSensor;
import javax.microedition.lcdui.Graphics;
import mielialat.Mieliala;

public class Maini {
	
	public static void piirraIloinen(Graphics graf) {
		graf.clear();
		graf.fillRect(10, 20, 10, 40);
		graf.fillRect(20, 20, 10, 10);
		graf.fillRect(30, 20, 10, 40);

		graf.fillRect(60, 20, 10, 40);
		graf.fillRect(70, 20, 10, 10);
		graf.fillRect(80, 20, 10, 40);
	}
	
	public static void piirraOk(Graphics graf) {
		graf.clear();
		graf.fillArc(10, 10, 25, 50, 90, 180);
		graf.fillArc(10, 10, 25, 50, 90, -180);
		graf.fillArc(60, 10, 25, 50, 90, 180);
		graf.fillArc(60, 10, 25, 50, 90, -180);
	}
	
	public static void piirraVihainen(Graphics graf) {
		graf.clear();
		graf.fillRect(3, 5, 10, 9);
		graf.fillRect(10, 10, 10, 9);
		graf.fillRect(17, 15, 10, 9);
		graf.fillRect(24, 20, 10, 9);
		graf.fillRect(31, 25, 10, 9);
		graf.fillRect(35, 30, 10, 9);
		graf.fillRect(31, 35, 10, 9);
		graf.fillRect(24, 40, 10, 9);
		graf.fillRect(17, 45, 10, 9);
		graf.fillRect(10, 50, 10, 9);
		graf.fillRect(3, 55, 10, 9);
		
		graf.fillRect(17, 35, 10, 20); // vasen pupilli
		graf.fillRect(71, 35, 10, 20); // oikea pupilli
	
		graf.fillRect(85, 5, 10, 9);
		graf.fillRect(78, 10, 10, 9);
		graf.fillRect(71, 15, 10, 9);
		graf.fillRect(64, 20, 10, 9);
		graf.fillRect(57, 25, 10, 9);
		graf.fillRect(53, 30, 10, 9);
		graf.fillRect(57, 35, 10, 9);
		graf.fillRect(64, 40, 10, 9);
		graf.fillRect(71, 45, 10, 9);
		graf.fillRect(78, 50, 10, 9);
		graf.fillRect(85, 55, 10, 9);	
	}
	
	public static void main(String[] args) throws Exception{
		
		Mieliala iloinen = new Mieliala("iloinen");
		Mieliala pelokas = new Mieliala("pelokas");
		Mieliala vihainen = new Mieliala("vihainen");
		Mieliala normaali = new Mieliala();

		TouchSensor tatsi = new TouchSensor(SensorPort.S1);
		UltrasonicSensor ultra = new UltrasonicSensor(SensorPort.S2);
		SoundSensor aani = new SoundSensor(SensorPort.S3, true);
		
		File bark = new File("brk.wav");
		File puppy = new File("pup.wav");
		File whine = new File("whi.wav");
		
		Graphics graf = new Graphics();
		graf.clear();
		graf.setStrokeStyle(0);
		graf.setColor(0);
		
		Sound.setVolume(80);
		ultra.continuous();
		
		while (!Button.ENTER.isDown()) { 		// ohjeet käyttäjälle näkyvät ruudulla, kunnes painetaan ENTER
			LCD.drawString("HEI!", 1, 2);
			LCD.drawString("Paina ENTER", 1, 4);
			LCD.drawString("aloittaaksesi.", 1, 6);
		}
		LCD.clear();
		LCD.drawString("PAIKKANI ON", 1, 3);
		LCD.drawString("LATTIALLA!", 1, 5);
		Thread.sleep(5000);					// pysäytä ohjelma 5000 ms ajaksi
		
		while (true) {
			piirraOk(graf);					// piirrä perusmieliala
			while (!tatsi.isPressed()) {
				Motor.A.setSpeed(400);		// aseta portin A moottorin nopeudeksi 400
				Motor.B.setSpeed(400);		// aseta portin B moottorin nopeudeksi 400
				Motor.A.backward();			// activoi porttiin A kytketty moottori
				Motor.B.backward();			// aktivoi porttiin B kytketty moottori
				if (ultra.getDistance() < 50) {
					Motor.A.stop();
					Motor.B.setSpeed(800);
					Motor.B.backward();
					Thread.sleep(700);		// odottaa hetken
				}
				if (aani.readValue() > 80) {
					Sound.setVolume(100);
					Sound.playSample(bark);
					piirraIloinen(graf);
					Motor.A.stop(); 		// pysäyttää moottorin portissa A
					Motor.B.stop();			// pysäyttää moottorin portissa B
					Delay.msDelay(800); 	//mahdollista nyt sammuttaa painamalla ESCAPE+ENTER!
					Sound.playSample(bark);
					Delay.msDelay(500);
					Sound.playSample(bark);
					Delay.msDelay(800);
					Sound.playSample(bark);
					Sound.setVolume(80);
					Delay.msDelay(1500);
					graf.clear();
					piirraOk(graf);
				}
			}
			Sound.playSample(whine);
			piirraVihainen(graf);
			Thread.sleep(800);
			Sound.playSample(puppy);
			Motor.A.setSpeed(200);
			Motor.B.setSpeed(200);
			Motor.A.forward();
			Motor.B.forward();
			Thread.sleep(1500);
			Motor.A.stop(); 		// pysäyttää moottorin portissa A
			Motor.B.stop();			// pysäyttää moottorin portissa B
			Thread.sleep(2000); 	//mahdollista nyt sammuttaa painamalla ESCAPE+ENTER!
		}
		
	}
}
